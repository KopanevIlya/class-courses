import{m as d,p as C,q as M,c as B,w as b,d as e,o,g as r,F as y,s as w,n as m,t as n,f as $,i as k,e as D,j as F,x as T,y as A,z as E}from"./app-CDIGo1jw.js";import{_ as S}from"./AuthenticatedLayout-BCkoaPOW.js";import"./ApplicationLogo-eY4yjRyy.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const U={class:"font-semibold text-xl text-gray-800 leading-tight"},V={class:"py-12"},I={class:"max-w-2xl mx-auto px-2"},N={class:"bg-white p-6 rounded-lg shadow-md"},z={class:"w-8 h-8 rounded-full bg-blue-200 flex items-center justify-center font-bold text-blue-800 text-sm"},q={class:"text-xs font-semibold mb-1 opacity-80"},H={key:0,class:"mt-2 space-y-1"},L=["href"],O={class:"flex items-center justify-center border rounded bg-white cursor-pointer hover:bg-gray-100 transition h-12 w-12 min-w-[3rem]",title:"Прикрепить файл"},G={key:0,class:"block text-gray-500 text-xs mt-1 truncate max-w-full"},R={__name:"Chat",props:{chat:Object,messages:Array},setup(f){const c=f,h=d(c.messages),i=d(""),l=d([]);let x=null;const u=d(null);function _(s){l.value=Array.from(s.target.files)}function v(){fetch(`/chats/${c.chat.id}/messages`).then(s=>s.json()).then(s=>{h.value=s,g()})}function j(){if(!i.value&&l.value.length===0)return;const s=new FormData;s.append("body",i.value),l.value.forEach(a=>s.append("files[]",a)),E.post(`/chats/${c.chat.id}/messages`,s,{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{i.value="",l.value=[],v()}})}function g(){A(()=>{u.value&&(u.value.scrollTop=u.value.scrollHeight)})}return C(()=>{x=setInterval(v,3e3),g()}),M(()=>{clearInterval(x)}),(s,a)=>(o(),B(S,null,{header:b(()=>[e("h2",U," Чат: "+n(f.chat.name),1)]),default:b(()=>[e("div",V,[e("div",I,[e("div",N,[e("div",{ref_key:"messagesEnd",ref:u,class:"space-y-4 mb-4 max-h-[400px] overflow-y-auto"},[(o(!0),r(y,null,w(h.value,t=>(o(),r("div",{key:t.id,class:m(["flex",t.user.email===s.$page.props.auth.user.email?"justify-end":"justify-start"])},[e("div",{class:m(["flex items-end space-x-2",t.user.email===s.$page.props.auth.user.email?"flex-row-reverse space-x-reverse":""])},[e("div",z,n(t.user.name?t.user.name.charAt(0).toUpperCase():t.user.email.charAt(0).toUpperCase()),1),e("div",{class:m(["px-4 py-2 rounded-lg min-w-[100px] max-w-[70vw] break-words",t.user.email===s.$page.props.auth.user.email?"bg-blue-500 text-white":"bg-gray-100 text-gray-800"])},[e("div",q,n(t.user.email),1),e("div",null,n(t.body),1),t.files&&t.files.length?(o(),r("div",H,[(o(!0),r(y,null,w(t.files,p=>(o(),r("div",{key:p.id},[e("a",{href:`/storage/${p.path}`,target:"_blank",class:"text-xs text-blue-400 hover:underline flex items-center"},[a[1]||(a[1]=e("svg",{class:"w-4 h-4 mr-1 inline-block",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.586-6.586a4 4 0 10-5.656-5.656l-6.586 6.586"})],-1)),$(" "+n(p.original_name),1)],8,L)]))),128))])):k("",!0)],2)],2)],2))),128))],512),e("form",{onSubmit:D(j,["prevent"]),class:"flex flex-col sm:flex-row items-stretch gap-2 mt-2"},[F(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>i.value=t),class:"flex-1 border rounded px-3 py-2 text-gray-700 focus:outline-none focus:ring focus:border-blue-400 transition h-12",placeholder:"Введите сообщение"},null,512),[[T,i.value]]),e("label",O,[e("input",{type:"file",multiple:"",onChange:_,class:"hidden"},null,32),a[2]||(a[2]=e("svg",{class:"w-6 h-6 text-gray-500",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.586-6.586a4 4 0 10-5.656-5.656l-6.586 6.586"})],-1))]),a[3]||(a[3]=e("button",{class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition h-12 w-full sm:w-auto",type:"submit"}," Отправить ",-1))],32),l.value&&l.value.length?(o(),r("span",G,n(l.value.map(t=>t.name).join(", ")),1)):k("",!0)])])])]),_:1}))}};export{R as default};
