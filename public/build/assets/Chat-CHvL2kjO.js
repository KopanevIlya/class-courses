import{m as d,p as C,q as j,c as M,w as g,d as e,o as l,g as o,F as y,s as w,n as m,t as n,f as $,i as B,e as D,j as F,x as T,y as A,z as E}from"./app-CH-PbhH5.js";import{_ as S}from"./AuthenticatedLayout-BQ9pN22M.js";import"./ApplicationLogo-BRa4b0U4.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const U={class:"font-semibold text-xl text-gray-800 leading-tight"},V={class:"py-12"},I={class:"max-w-2xl mx-auto px-2"},N={class:"bg-white p-6 rounded-lg shadow-md"},z={class:"w-8 h-8 rounded-full bg-blue-200 flex items-center justify-center font-bold text-blue-800 text-sm"},q={class:"text-xs font-semibold mb-1 opacity-80"},H={key:0,class:"mt-2 space-y-1"},L=["href"],P={__name:"Chat",props:{chat:Object,messages:Array},setup(f){const c=f,h=d(c.messages),r=d(""),i=d([]);let v=null;const u=d(null);function _(s){i.value=Array.from(s.target.files)}function x(){fetch(`/chats/${c.chat.id}/messages`).then(s=>s.json()).then(s=>{h.value=s,b()})}function k(){if(!r.value&&i.value.length===0)return;const s=new FormData;s.append("body",r.value),i.value.forEach(a=>s.append("files[]",a)),E.post(`/chats/${c.chat.id}/messages`,s,{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{r.value="",i.value=[],x()}})}function b(){A(()=>{u.value&&(u.value.scrollTop=u.value.scrollHeight)})}return C(()=>{v=setInterval(x,3e3),b()}),j(()=>{clearInterval(v)}),(s,a)=>(l(),M(S,null,{header:g(()=>[e("h2",U," Чат: "+n(f.chat.name),1)]),default:g(()=>[e("div",V,[e("div",I,[e("div",N,[e("div",{ref_key:"messagesEnd",ref:u,class:"space-y-4 mb-4 max-h-[400px] overflow-y-auto"},[(l(!0),o(y,null,w(h.value,t=>(l(),o("div",{key:t.id,class:m(["flex",t.user.email===s.$page.props.auth.user.email?"justify-end":"justify-start"])},[e("div",{class:m(["flex items-end space-x-2",t.user.email===s.$page.props.auth.user.email?"flex-row-reverse space-x-reverse":""])},[e("div",z,n(t.user.name?t.user.name.charAt(0).toUpperCase():t.user.email.charAt(0).toUpperCase()),1),e("div",{class:m(["px-4 py-2 rounded-lg min-w-[100px] max-w-[70vw] break-words",t.user.email===s.$page.props.auth.user.email?"bg-blue-500 text-white":"bg-gray-100 text-gray-800"])},[e("div",q,n(t.user.email),1),e("div",null,n(t.body),1),t.files&&t.files.length?(l(),o("div",H,[(l(!0),o(y,null,w(t.files,p=>(l(),o("div",{key:p.id},[e("a",{href:`/storage/${p.path}`,target:"_blank",class:"text-xs text-blue-200 hover:underline flex items-center"},[a[1]||(a[1]=e("svg",{class:"w-4 h-4 mr-1 inline-block",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.586-6.586a4 4 0 10-5.656-5.656l-6.586 6.586"})],-1)),$(" "+n(p.original_name),1)],8,L)]))),128))])):B("",!0)],2)],2)],2))),128))],512),e("form",{onSubmit:D(k,["prevent"]),class:"flex flex-col sm:flex-row gap-2 items-stretch"},[F(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>r.value=t),class:"flex-1 border rounded px-3 py-2",placeholder:"Введите сообщение"},null,512),[[T,r.value]]),e("input",{type:"file",multiple:"",onChange:_,class:"block border rounded px-2 py-1"},null,32),a[2]||(a[2]=e("button",{class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded",type:"submit"},"Отправить",-1))],32)])])])]),_:1}))}};export{P as default};
